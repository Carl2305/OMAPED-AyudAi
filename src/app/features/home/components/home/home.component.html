<div class="home fade-in">
  <!-- Main Content -->
  <div class="main-content">
    <h2 class="section-title">
      <i class="fas fa-car"></i>
      Mis Créditos
    </h2>

    <div class="credit-cards">
      <div
        *ngFor="let credit of credits; let i = index"
        class="credit-card"
        [class.collapsed]="!credit.isExpanded"
        [style.background]="credit.isExpanded ? getCardGradient(i) : getCardCollapsedGradient(i)"
        (click)="toggleCard(credit)">

        <!-- Card Header -->
        <div class="card-header">
          <div class="card-number"># {{ credit.operation_id }}</div>
          <i class="fas fa-car" style="font-size: 1.5rem;"></i>
        </div>

        <!-- Always visible content -->
        <div class="card-amount">{{ credit.currency }} ${{ formatCurrency(credit.current_debt) }}</div>
        <div style="font-size: 0.9rem; opacity: 0.9;">Deuda Actual</div>

        <!-- <div class="expandable-content" *ngIf="credit.isExpanded"> -->
          <!-- Progress bar -->
          <div class="progress-container">
            <div style="display: flex; justify-content: space-between; font-size: 0.85rem; margin-bottom: 5px;">
              <span>Progreso del pago</span>
              <span>{{ calculateProgress(credit.fees_paid, credit.total_fees) }}% completado</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill-red" [style.width.%]="calculateProgress(credit.fees_paid, credit.total_fees)"></div>
            </div>
          </div>

        <!-- Expandable content -->
        <div class="expandable-content" *ngIf="credit.isExpanded">
          <!-- Card details -->
          <div class="card-details">
            <div class="card-detail">
              <div class="card-detail-label">Próxima Cuota</div>
              <div class="card-detail-value">${{ formatCurrency(credit.next_fee) }}</div>
            </div>
            <div class="card-detail">
              <div class="card-detail-label">Cuotas Pagadas</div>
              <div class="card-detail-value">{{ credit.fees_paid }} / {{ credit.total_fees }}</div>
            </div>
            <div class="card-detail">
              <div class="card-detail-label">Vencimiento</div>
              <div class="card-detail-value">{{ formatDate(credit.expiration_date) }}</div>
            </div>
            <div class="card-detail">
              <div class="card-detail-label">Estado</div>
              <div class="card-detail-value">
                <span [ngClass]="{'status-paid': isPaidOff(credit), 'status-overdue': isOverdue(credit.expiration_date) && !isPaidOff(credit)}">
                  {{ getStatusText(credit) }}
                </span>
              </div>
            </div>
          </div>

          <!-- Quick Actions for this specific card -->
          <div class="card-actions">
            <button *ngIf="isPaidOff(credit)" class="action-btn" (click)="$event.stopPropagation(); payInstallment(credit.operation_id)">
              <i class="fas fa-credit-card"></i> Pagar Cuota
            </button>
            <button class="action-btn" (click)="$event.stopPropagation(); downloadContract(credit.operation_id)">
              <i class="fas fa-download"></i> Descargar Contrato
            </button>
            <button class="action-btn" (click)="$event.stopPropagation(); viewSchedule(credit.operation_id)">
              <i class="fas fa-calendar"></i> Descargar Cronograma
            </button>
            <button class="action-btn" (click)="$event.stopPropagation(); downloadAccountStatus(credit.operation_id)">
              <i class="fas fa-download"></i> Estado de Cuenta
            </button>
            <button *ngIf="isPaidOff(credit)" class="action-btn" (click)="$event.stopPropagation(); downloadNoDebtLetter(credit.operation_id)">
              <i class="fas fa-download"></i> Carta No Adeudo
            </button>
            <button *ngIf="isPaidOff(credit)" class="action-btn" (click)="$event.stopPropagation(); downloadNoDebtLetter(credit.operation_id)">
              <i class="fas fa-download"></i> Levantamiento de Garantía
            </button>
          </div>
        </div>

        <!-- Collapse indicator -->
        <div class="collapse-indicator" *ngIf="!credit.isExpanded">
          <i class="fas fa-chevron-down"></i>
          <span>Toca para ver detalles</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Sidebar -->
  <aside class="sidebar">
    <!-- NEWS Widget -->
    <app-card-slider></app-card-slider>

    <!-- Social Media Widget -->
    <app-card-social> </app-card-social>

    <!-- Quick Stats -->
    <div class="widget">
      <h3 class="widget-title">
        <i class="fas fa-chart-line"></i>
        Resumen
      </h3>
      <div style="display: flex; flex-direction: column; gap: 15px;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <span style="color: #666;">Total Deuda</span>
          <strong style="color: #e53e3e;">$28,029.44</strong>
        </div>
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <span style="color: #666;">Próximos Pagos</span>
          <strong style="color: #38a169;">$2,443.86</strong>
        </div>
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <span style="color: #666;">Créditos Activos</span>
          <strong style="color: #667eea;">2</strong>
        </div>
      </div>
    </div>
  </aside>
</div>
