<div class="login-card">
  <div class="login-header">
    <h1 class="title">Iniciar Sesión</h1>
  </div>
  <form [formGroup]="loginForm" (ngSubmit)="onSubmit()" class="login-form" novalidate>
    <!-- Alert de Error -->
    <div class="alert alert-error" *ngIf="error" role="alert">
      <svg class="icon-alert-circle" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
      </svg>
      <span>{{ error }}</span>
    </div>
    <!-- Campo Usuario -->
    <div class="form-group">
      <label for="username" class="form-label">Nro. Documento</label>
      <div class="input-wrapper">
        <svg class="input-icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
        </svg>
        <input
          type="text"
          id="username"
          formControlName="username"
          class="form-input"
          [class.error]="username?.invalid && username?.touched"
          placeholder="Nro. Documento"
          autocomplete="username"
        >
      </div>
      <div class="form-error" *ngIf="username?.invalid && username?.touched">
        <span *ngIf="username?.errors?.['required']">El usuario es requerido</span>
        <span *ngIf="username?.errors?.['minlength']">Mínimo 3 caracteres</span>
      </div>
    </div>
    <!-- Campo Contraseña -->
    <div class="form-group">
      <label for="password" class="form-label">Contraseña</label>
      <div class="input-wrapper">
        <svg class="input-icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M18,8h-1V6c0-2.76-2.24-5-5-5S7,3.24,7,6v2H6c-1.1,0-2,0.9-2,2v10c0,1.1,0.9,2,2,2h12c1.1,0,2-0.9,2-2V10C20,8.9,19.1,8,18,8z M12,17c-1.1,0-2-0.9-2-2s0.9-2,2-2s2,0.9,2,2S13.1,17,12,17z M15.1,8H8.9V6c0-1.71,1.39-3.1,3.1-3.1s3.1,1.39,3.1,3.1V8z"/>
        </svg>
        <input
          [type]="showPassword ? 'text' : 'password'"
          id="password"
          formControlName="password"
          class="form-input"
          [class.error]="password?.invalid && password?.touched"
          placeholder="Ingrese su contraseña"
          autocomplete="current-password"
          (click)="onPasswordInputClick()"
          readonly
          [maxLength]="6"
          [minLength]="6"
        >
        <button
          type="button"
          class="toggle-password"
          (click)="togglePasswordVisibility()"
          [attr.aria-label]="showPassword ? 'Ocultar contraseña' : 'Mostrar contraseña'"
        >
          <svg [class]="showPassword ? 'icon-eye-off' : 'icon-eye'" viewBox="0 0 24 24" fill="currentColor">
            <path *ngIf="!showPassword" d="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z"/>
            <path *ngIf="showPassword" d="M11.83,9L15,12.16C15,12.11 15,12.05 15,12A3,3 0 0,0 12,9C11.94,9 11.89,9 11.83,9M7.53,9.8L9.08,11.35C9.03,11.56 9,11.77 9,12A3,3 0 0,0 12,15C12.22,15 12.44,14.97 12.65,14.92L14.2,16.47C13.53,16.8 12.79,17 12,17A5,5 0 0,1 7,12C7,11.21 7.2,10.47 7.53,9.8M2,4.27L4.28,6.55L4.73,7C3.08,8.3 1.78,10 1,12C2.73,16.39 7,19.5 12,19.5C13.55,19.5 15.03,19.2 16.38,18.66L16.81,19.09L19.73,22L21,20.73L3.27,3M12,7A5,5 0 0,1 17,12C17,12.64 16.87,13.26 16.64,13.82L19.57,16.75C21.07,15.5 22.27,13.86 23,12C21.27,7.61 17,4.5 12,4.5C10.6,4.5 9.26,4.75 8,5.2L10.17,7.35C10.76,7.13 11.37,7 12,7Z"/>
          </svg>
        </button>
      </div>
      <div class="form-error" *ngIf="password?.invalid && password?.touched">
        <span *ngIf="password?.errors?.['required']">La contraseña es requerida</span>
        <span *ngIf="password?.errors?.['minlength']">Mínimo 6 caracteres</span>
        <span *ngIf="password?.errors?.['maxlength']">Máximo 6 caracteres</span>
      </div>

      <!--Teclado Virtual-->
      <app-keyboard-virtual
        *ngIf="showKeyboard"
        #keyboardVirtual
        (valueChange)="onKeyboardValueChange($event)"
        (hideKeyboard)="onKeyboardHide()">
      </app-keyboard-virtual>

      <app-code-captcha
        *ngIf="showCodeCaptcha"
        #CodeCaptcha
        [shouldLoad]="shouldLoadCaptcha"
        (valueChange)="onCodeCaptchaValueChange($event)">
      </app-code-captcha>

    </div>
    <!-- Botón de Login -->
    <button
      type="submit"
      class="login-button"
      [disabled]="loading || loginForm.invalid"
    >
      <span *ngIf="loading" class="spinner"></span>
      <span>{{ loading ? 'Iniciando sesión...' : 'Iniciar Sesión' }}</span>
    </button>
    <!-- Enlaces adicionales -->
    <div class="login-links">
      <a routerLink="/auth/forgot-password" class="link">Restablecer mi contraseña</a>
      <a routerLink="/" class="link">Soy nuevo, quiero registrarme</a>
    </div>
  </form>
</div>
